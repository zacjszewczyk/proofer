<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Proofer - Identify Elements of Weak Writing</title>
    <meta name="description" content="A single-page writing analysis tool. Identify complex words, overused phrases, and readability issues in your writing.">
    <style>
        /* Reset */
        * { margin: 0; padding: 0; box-sizing: border-box; }

        /* Main layout */
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; display: flex; flex-direction: column; height: 100vh; background: #f5f5f5; color: #333; }

        /* Top bar */
        header { display: flex; align-items: center; justify-content: space-between; padding: 0.75rem 1.5rem; background: #2A1A0F; color: white; }
        header h1 { font-size: 1.25rem; font-weight: 600; }
        header .actions { display: flex; gap: 0.5rem; }
        header button { padding: 0.4rem 0.8rem; border: 1px solid rgba(255,255,255,0.3); background: transparent; color: white; border-radius: 4px; cursor: pointer; font-size: 0.85rem; }
        header button:hover { background: rgba(255,255,255,0.15); }

        /* Editor area */
        .editor-container { display: flex; flex: 1; min-height: 0; gap: 1px; background: #ddd; }
        .panel { flex: 1; display: flex; flex-direction: column; background: white; }
        .panel-header { padding: 0.5rem 1rem; background: #f0f0f0; border-bottom: 1px solid #ddd; font-weight: 600; font-size: 0.9rem; }
        .panel textarea { flex: 1; padding: 1rem; border: none; outline: none; font-family: "Courier New", monospace; font-size: 0.95rem; resize: none; line-height: 1.8; }
        .panel .preview { flex: 1; padding: 1rem; overflow-y: auto; font-family: sans-serif; font-size: 0.95rem; line-height: 1.8; outline: none; }

        /* Statistics bar */
        .stats-bar { padding: 0.6rem 1.5rem; background: #2A1A0F; color: white; display: flex; flex-wrap: wrap; gap: 1rem; font-size: 0.8rem; align-items: center; }
        .stats-bar .stat { display: flex; align-items: center; gap: 0.25rem; }
        .stats-bar .stat-label { opacity: 0.7; }
        .stats-bar .stat-value { font-weight: 700; }
        .stats-bar .separator { width: 1px; height: 1rem; background: rgba(255,255,255,0.3); }

        /* Legend */
        .legend { padding: 0.5rem 1.5rem; background: #f0f0f0; border-top: 1px solid #ddd; display: flex; gap: 1.5rem; font-size: 0.8rem; flex-wrap: wrap; }
        .legend-item { display: flex; align-items: center; gap: 0.3rem; }
        .legend-swatch { width: 14px; height: 14px; border-radius: 3px; display: inline-block; }

        /* Highlight classes - matching original Proofer CSS */
        .avoid { padding: 1pt 0.25em; border-radius: 0.25em; background-color: #ED9C9D99; }
        .alternate, .trite { padding: 1pt 0.25em; border-radius: 0.25em; background-color: #A72BDD99; }
        .dup { padding: 1pt 0.25em; border-radius: 0.25em; background-color: #91910f59; }
        .long { padding: 1pt 0.25em; border-radius: 0.25em; background-color: #a8c5d899; }

        /* Readability score colors */
        .extreme { background-color: #FF6666; padding: 2px 6px; border-radius: 3px; }
        .hard { background-color: #D77751; padding: 2px 6px; border-radius: 3px; }
        .tough { background-color: #C38047; padding: 2px 6px; border-radius: 3px; }
        .plain { background-color: #9B9233; padding: 2px 6px; border-radius: 3px; }
        .fair { background-color: #73A41E; padding: 2px 6px; border-radius: 3px; color: white; }
        .easy { background-color: #5FAD14; padding: 2px 6px; border-radius: 3px; color: white; }
        .simple { background-color: #37BF00; padding: 2px 6px; border-radius: 3px; color: white; }

        /* Tooltip styling */
        .tooltip { position: relative; display: inline; }
        .tooltip .tooltiptext {
            visibility: hidden; position: absolute; z-index: 10; bottom: 125%; left: 50%;
            transform: translateX(-50%); background: #333; color: white; padding: 6px 10px;
            border-radius: 4px; font-size: 0.8rem; white-space: nowrap;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        .tooltip:hover .tooltiptext { visibility: visible; }

        /* Paragraphs in preview */
        .preview p { margin: 0.75em 0; }
        .preview h1, .preview h2, .preview h3, .preview h4, .preview h5, .preview h6 { margin: 1em 0 0.5em; }
        .preview ul, .preview ol { margin: 0.5em 0 0.5em 2em; }
        .preview blockquote { margin: 0.5em 0 0.5em 1em; padding-left: 1em; border-left: 3px solid #ccc; }
        .preview pre, .preview code { background: #f1f1f1; font-family: "Courier New", monospace; border-radius: 4px; padding: 2px 4px; }
        .preview pre { padding: 1em; overflow-x: auto; }
    </style>
</head>
<body>
    <header>
        <h1>üìù Proofer</h1>
        <div class="actions">
            <button id="btn-import">Import DOCX</button>
            <button id="btn-export-md">Export Markdown</button>
            <button id="btn-export-docx">Export DOC</button>
            <button id="btn-clear">Clear</button>
            <input type="file" id="file-input" accept=".docx" hidden>
        </div>
    </header>

    <div class="editor-container">
        <div class="panel">
            <div class="panel-header">Source (Markdown)</div>
            <textarea id="source" placeholder="Paste or type your Markdown text here..."></textarea>
        </div>
        <div class="panel">
            <div class="panel-header">Proofed Preview</div>
            <div id="preview" class="preview" contenteditable="true">
                <p style="color:#999">Preview will appear here...</p>
            </div>
        </div>
    </div>

    <div class="stats-bar" id="stats-bar">
        <span class="stat"><span class="stat-label">Words:</span> <span class="stat-value" id="stat-words">0</span></span>
        <span class="separator"></span>
        <span class="stat"><span class="stat-label">Sentences:</span> <span class="stat-value" id="stat-sentences">0</span></span>
        <span class="separator"></span>
        <span class="stat"><span class="stat-label">Paragraphs:</span> <span class="stat-value" id="stat-paragraphs">0</span></span>
        <span class="separator"></span>
        <span class="stat"><span class="stat-label">Avg Words/Sentence:</span> <span class="stat-value" id="stat-avg-wps">0</span></span>
        <span class="separator"></span>
        <span class="stat"><span class="stat-label">Complex Words:</span> <span class="stat-value" id="stat-complex">0</span></span>
        <span class="separator"></span>
        <span class="stat"><span class="stat-label">Syllables/Word:</span> <span class="stat-value" id="stat-avg-syl">0</span></span>
        <span class="separator"></span>
        <span class="stat"><span class="stat-label">Fog Index ‚Üì:</span> <span class="stat-value" id="stat-fog">0</span></span>
        <span class="separator"></span>
        <span class="stat"><span class="stat-label">Reading Ease ‚Üë:</span> <span class="stat-value" id="stat-reading-ease">0</span></span>
        <span class="separator"></span>
        <span class="stat"><span class="stat-label">Grade Level ‚Üì:</span> <span class="stat-value" id="stat-grade">0</span></span>
        <span class="separator"></span>
        <span class="stat"><span class="stat-label">Overused Phrases:</span> <span class="stat-value" id="stat-overused">0</span></span>
        <span class="separator"></span>
        <span class="stat"><span class="stat-label">Words to Avoid:</span> <span class="stat-value" id="stat-avoid">0</span></span>
        <span class="separator"></span>
        <span class="stat"><span class="stat-label">Repeated Words:</span> <span class="stat-value" id="stat-repeated">0</span></span>
    </div>

    <div class="legend">
        <div class="legend-item"><span class="legend-swatch" style="background:#a8c5d899"></span> Complex (3+ syllables)</div>
        <div class="legend-item"><span class="legend-swatch" style="background:#91910f59"></span> Repeated words</div>
        <div class="legend-item"><span class="legend-swatch" style="background:#ED9C9D99"></span> Words to avoid</div>
        <div class="legend-item"><span class="legend-swatch" style="background:#A72BDD99"></span> Overused / trite phrases</div>
        <div class="legend-item"><span class="legend-swatch" style="background:#A72BDD99"></span> Alternatives suggested</div>
    </div>

    <script src="lib/mammoth.browser.min.js"></script>
    <script src="lib/proofer.js"></script>
    <script>
    (function() {
        var source = document.getElementById('source');
        var preview = document.getElementById('preview');
        var fileInput = document.getElementById('file-input');
        var debounceTimer = null;

        // Debounced analysis
        source.addEventListener('input', function() {
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(runAnalysis, 500);
        });

        function runAnalysis() {
            var text = source.value;
            if (!text.trim()) {
                preview.innerHTML = '<p style="color:#999">Preview will appear here...</p>';
                resetStats();
                return;
            }
            var result = Proofer.analyze(text);
            preview.innerHTML = result.html;
            updateStats(result.stats);
        }

        function updateStats(s) {
            document.getElementById('stat-words').textContent = s.word_count;
            document.getElementById('stat-sentences').textContent = s.sentence_count;
            document.getElementById('stat-paragraphs').textContent = s.paragraph_count;
            document.getElementById('stat-avg-wps').textContent = s.avg_words_per_sentence.toFixed(2);
            document.getElementById('stat-complex').textContent = s.complex_words;
            document.getElementById('stat-avg-syl').textContent = s.avg_syllables.toFixed(2);
            document.getElementById('stat-fog').textContent = s.fog_index.toFixed(2);

            var reEl = document.getElementById('stat-reading-ease');
            reEl.textContent = s.reading_ease.toFixed(2);
            reEl.className = 'stat-value ' + s.reading_ease_class;

            document.getElementById('stat-grade').textContent = s.grade_level.toFixed(2);
            document.getElementById('stat-overused').textContent = s.overused_phrase_count;
            document.getElementById('stat-avoid').textContent = s.avoid_word_count;
            document.getElementById('stat-repeated').textContent = s.repeated_word_count;
        }

        function resetStats() {
            var ids = ['stat-words','stat-sentences','stat-paragraphs','stat-avg-wps','stat-complex','stat-avg-syl','stat-fog','stat-grade','stat-overused','stat-avoid','stat-repeated'];
            for (var i = 0; i < ids.length; i++) {
                document.getElementById(ids[i]).textContent = '0';
            }
            var reEl = document.getElementById('stat-reading-ease');
            reEl.textContent = '0';
            reEl.className = 'stat-value';
        }

        // Import DOCX
        document.getElementById('btn-import').addEventListener('click', function() {
            fileInput.click();
        });

        fileInput.addEventListener('change', function(e) {
            var file = e.target.files[0];
            if (!file) return;
            var reader = new FileReader();
            reader.onload = function(ev) {
                mammoth.extractRawText({arrayBuffer: ev.target.result})
                    .then(function(result) {
                        source.value = result.value;
                        runAnalysis();
                    })
                    .catch(function(err) {
                        alert('Error reading DOCX: ' + err.message);
                    });
            };
            reader.readAsArrayBuffer(file);
            fileInput.value = '';
        });

        // Export Markdown
        document.getElementById('btn-export-md').addEventListener('click', function() {
            var text = source.value;
            if (!text.trim()) return;
            download('document.md', text, 'text/plain');
        });

        // Export DOCX (HTML-as-DOC format, widely supported by Word)
        document.getElementById('btn-export-docx').addEventListener('click', function() {
            var content = preview.innerHTML || '';
            if (!content.trim()) return;
            var docHtml = '<!DOCTYPE html><html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:w="urn:schemas-microsoft-com:office:word" xmlns="http://www.w3.org/TR/REC-html40"><head><meta charset="utf-8"><title>Export</title><style>body{font-family:Calibri,sans-serif;font-size:11pt;line-height:1.6;}</style></head><body>' + content + '</body></html>';
            download('document.doc', docHtml, 'application/msword');
        });

        // Clear
        document.getElementById('btn-clear').addEventListener('click', function() {
            source.value = '';
            preview.innerHTML = '<p style="color:#999">Preview will appear here...</p>';
            resetStats();
        });

        // Download helper
        function download(filename, content, mimeType) {
            var blob = new Blob([content], {type: mimeType});
            var url = URL.createObjectURL(blob);
            var a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
    })();
    </script>
</body>
</html>
